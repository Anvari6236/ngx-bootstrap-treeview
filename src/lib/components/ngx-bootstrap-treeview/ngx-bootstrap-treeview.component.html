<!-- This part is used if we have a single tree inputed to our component -->
<ul
    [ngClass]="{
        branch: tree.children,
        leaf: !tree.children,
        opened: isOpened,
        'pl-0': isFirstLevel,
        disabled: isLeaf && isOpened && disableSelectedElements
    }"
    *ngIf="tree"
    class="mb-0"
>
    <li>
        <a [routerLink]="[]" (click)="onClick()" (contextmenu)="onContextMenu($event)">
            <!-- Icons if we're reprensenting a branch -->
            <span class="icon">
                <!-- Folder closed, no children selected -->
                <fa-icon
                    [fixedWidth]="true"
                    [icon]="closedFolderIcon"
                    *ngIf="tree.children && !isOpened && !selectedLeaves.length"
                ></fa-icon>

                <!-- Folder closed, children selected but not all -->
                <fa-layers
                    [fixedWidth]="true"
                    *ngIf="
                        tree.children &&
                        !isOpened &&
                        selectedLeaves.length > 0 &&
                        selectedLeaves.length < this.leavesCount
                    "
                >
                    <fa-icon [fixedWidth]="true" [icon]="closedFolderIcon"></fa-icon>
                    <fa-icon [fixedWidth]="true" [icon]="anyChildrenSelectedIcon" transform="shrink-6 down-1"></fa-icon>
                </fa-layers>

                <!-- Folder closed, all children selected -->
                <fa-layers
                    [fixedWidth]="true"
                    *ngIf="tree.children && !isOpened && selectedLeaves.length === leavesCount && leavesCount > 0"
                >
                    <fa-icon [fixedWidth]="true" [icon]="closedFolderIcon"></fa-icon>
                    <fa-icon [fixedWidth]="true" [icon]="allChildrenSelectedIcon" transform="shrink-8 down-1"></fa-icon>
                </fa-layers>

                <!-- Folder opened, no children selected -->
                <fa-icon
                    [fixedWidth]="true"
                    [icon]="openedFolderIcon"
                    *ngIf="tree.children && isOpened && !selectedLeaves.length"
                ></fa-icon>

                <!-- Folder opened, children selected but not all -->
                <fa-layers
                    [fixedWidth]="true"
                    *ngIf="
                        tree.children &&
                        isOpened &&
                        selectedLeaves.length > 0 &&
                        selectedLeaves.length < this.leavesCount
                    "
                >
                    <fa-icon [fixedWidth]="true" [icon]="openedFolderIcon"></fa-icon>
                    <fa-icon
                        [fixedWidth]="true"
                        [icon]="anyChildrenSelectedIcon"
                        transform="shrink-8 down-3 right-2"
                        class="opened-folder-mask"
                    ></fa-icon>
                </fa-layers>
                <!-- Folder opened, all children selected -->
                <fa-layers
                    [fixedWidth]="true"
                    *ngIf="tree.children && isOpened && selectedLeaves.length === leavesCount && leavesCount > 0"
                >
                    <fa-icon [fixedWidth]="true" [icon]="openedFolderIcon"></fa-icon>
                    <fa-icon
                        [fixedWidth]="true"
                        [icon]="allChildrenSelectedIcon"
                        transform="shrink-12 down-3 right-1"
                        class="opened-folder-mask"
                    ></fa-icon>
                </fa-layers>
                <!-- /branch icons -->

                <!-- Icons if we're reprensenting a leaf -->
                <fa-icon [fixedWidth]="true" [icon]="unselectedLeafIcon" *ngIf="!tree.children && !isOpened"></fa-icon>
                <fa-icon [fixedWidth]="true" [icon]="selectedLeafIcon" *ngIf="!tree.children && isOpened"></fa-icon>
            </span>
            <span class="label">
                {{ tree.label }}
            </span>
        </a>

        <!-- Custom context menu -->
        <ngx-bootstrap-treeview-context-menu
            *ngIf="contextMenus && contextMenus.leafMenu && isLeaf"
            [config]="contextMenus.leafMenu"
            [firedBy]="lastContextMenuEvent"
            [target]="tree"
        >
        </ngx-bootstrap-treeview-context-menu>
        <ngx-bootstrap-treeview-context-menu
            *ngIf="contextMenus && contextMenus.branchMenu && isBranch"
            [config]="contextMenus.branchMenu"
            [firedBy]="lastContextMenuEvent"
            [target]="tree"
        >
        </ngx-bootstrap-treeview-context-menu>
        <!-- END Custom context menu -->

        <div
            *ngIf="tree.children && isOpened"
            class="children"
            [@.disabled]="isAnimationDisabled"
            [@childrenAnimationTrigger]
        >
            <ul *ngIf="tree.children.length === 0">
                <li>
                    <i>{{ emptyFolderLabel }}</i>
                </li>
            </ul>
            <ng-container *ngFor="let branch of tree.children">
                <ngx-bootstrap-treeview
                    *ngIf="onElementAdded()"
                    [tree]="branch"
                    (branchClicked)="onChildBranchClicked($event)"
                    (leafClicked)="onChildLeafClicked($event)"
                    [selectedLeafIcon]="selectedLeafIcon"
                    [unselectedLeafIcon]="unselectedLeafIcon"
                    [openedFolderIcon]="openedFolderIcon"
                    [closedFolderIcon]="closedFolderIcon"
                    [canSelectBranch]="canSelectBranch"
                    [anyChildrenSelectedIcon]="anyChildrenSelectedIcon"
                    [allChildrenSelectedIcon]="allChildrenSelectedIcon"
                    [loggingService]="loggingService"
                    [contextMenus]="contextMenus"
                    [isFirstLevel]="false"
                    [disableSelectedElements]="disableSelectedElements"
                    [filterString]="filterString"
                >
                </ngx-bootstrap-treeview>
            </ng-container>
        </div>
    </li>
</ul>
<!-- END Single tree provided -->

<!-- If we provided an array of trees as an input, this part will be called -->
<ng-container *ngIf="trees && !tree">
    <ngx-bootstrap-treeview
        *ngFor="let tree of trees"
        [tree]="tree"
        (branchClicked)="onChildBranchClicked($event)"
        (leafClicked)="onChildLeafClicked($event)"
        [selectedLeafIcon]="selectedLeafIcon"
        [unselectedLeafIcon]="unselectedLeafIcon"
        [openedFolderIcon]="openedFolderIcon"
        [closedFolderIcon]="closedFolderIcon"
        [canSelectBranch]="canSelectBranch"
        [anyChildrenSelectedIcon]="anyChildrenSelectedIcon"
        [allChildrenSelectedIcon]="allChildrenSelectedIcon"
        [loggingService]="loggingService"
        [contextMenus]="contextMenus"
        [disableSelectedElements]="disableSelectedElements"
        [isAnimationDisabled]="isAnimationDisabled"
        [filterString]="filterString"
    ></ngx-bootstrap-treeview>
</ng-container>
<!-- End multiple trees provided -->
